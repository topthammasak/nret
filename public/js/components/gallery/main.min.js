function Gallery(){this.name="gallery",this.monitor="",this.monitor_h=0,this.monitor_w=0,this.monitor_c=0,this.moveto=0,this.moving=!1,this.speed=400,this.figure="",this.thumb="",this.amount=0,this.last="",this.current="",this.dragging=!1,this.dragmoved=!1,this.prev=$('<a class="arrow arrow-left"><span></span><span></span></a>'),this.next=$('<a class="arrow arrow-right"><span></span><span></span></a>'),this.lasttime=0}var Gallery;define(["jquery","jqTransit","magnificPopup"],function(){return Gallery=new Gallery}),Gallery.prototype={init:function(e){Gallery.target=$(e),Gallery.monitor=Gallery.target.find('[data-gallery="monitor"]'),Gallery.figures=Gallery.target.find('[data-gallery="figure"]'),Gallery.thumb=Gallery.target.find('[data-gallery="thumbnail"]'),Gallery.monitor_h=Gallery.monitor.height(),Gallery.monitor_w=Gallery.monitor.width(),Gallery.monitor_c=Gallery.monitor_w/2,Gallery.monitor.append(Gallery.prev.addClass("disabled")),Gallery.monitor.append(Gallery.next),Gallery.current=Gallery.figures.find("figure").filter(".selected"),Gallery.createFigues(),Gallery.next.on("click",function(){Gallery.moveImage("next")}),Gallery.prev.on("click",function(){Gallery.moveImage("prev")}),Gallery.thumb.on("click","a",function(e){Gallery.thumbEvent(e)});var l=0,a=0,r=0,t=150;$(window).on({mousedown:function(e){var a=$(e.target);(a.is(Gallery.thumb)||a.closest(Gallery.thumb).length)&&(e.preventDefault(),Gallery.dragging=!0,l=e.pageX,r=parseFloat(Gallery.thumb.css("x"))),Gallery.lasttime=(new Date).getTime()},mousemove:function(e){Gallery.dragging&&(a=e.pageX-l,a+=r,Gallery.thumb.css({x:a}),Gallery.dragmoved=!0)},mouseup:function(){if(Gallery.dragging){parseFloat(Gallery.thumb.css("x"))>0&&Gallery.thumb.transition({x:0},t);var e=Gallery.thumb.position().left+Gallery.thumb.width(),l=Gallery.monitor_w-Gallery.thumb.width();e<Gallery.monitor_w&&Gallery.thumb.transition({x:l},t),Gallery.dragging=!1,window.setTimeout(function(){Gallery.dragmoved=!1},10)}}}),$(window).resize(function(){Gallery.monitor_h=Gallery.monitor.height(),Gallery.monitor_w=Gallery.monitor.width(),Gallery.monitor_c=Gallery.monitor_w/2,Gallery.createFigues(!0)})},calcAspectRatio:function(e,l,a,r){var t=Math.min(a/e,r/l);return{height:Math.round(l*t),width:Math.round(e*t)}},createFigues:function(e){var l=[];e=void 0===e?!1:!0,$.each(Gallery.figures.find("figure"),function(e,a){var r=$(a),t=r.data("height"),i=r.data("width"),n=r.data("thumb"),o=r.data("type"),s=r.data("name"),y=Gallery.calcAspectRatio(i,t,Gallery.monitor_w,Gallery.monitor_h);void 0!==t&&void 0!==i&&(r.find("img").css({height:y.height,width:y.width}),y?(Gallery.moveto=Gallery.calcMoveTo(),Gallery.figures.css("x",Gallery.moveto)):0===e&&(Gallery.moveto=Gallery.monitor_c-y.width/2,Gallery.figures.css("x",Gallery.moveto)),Gallery.thumb.find("li").length||(l.push($("<li"+(r.hasClass("selected")?' class="selected"':"")+'><a><img src="'+n+'"></a></li>')),"video"===o&&r.append('<a href="http://vimeo.com/'+s+'" class="video popup-vimeo"><span class="pdl-play"></span></a>')))}),Gallery.thumb.find("li").length||(Gallery.thumb.append(l),Gallery.amount=l.length,$(".popup-youtube, .popup-vimeo, .popup-gmaps").magnificPopup({disableOn:700,type:"iframe",mainClass:"mfp-fade",removalDelay:160,preloader:!1,fixedContentPos:!1}))},moveImage:function(e){var l="next"===e?Gallery.current.next():Gallery.current.prev();l.length&&!Gallery.moving&&(Gallery.moving=!0,Gallery.last=Gallery.current,Gallery.current=l,"next"===e?(Gallery.prev.filter(".disabled").removeClass("disabled"),Gallery.current.next().length||Gallery.next.addClass("disabled")):(Gallery.next.filter(".disabled").removeClass("disabled"),Gallery.current.prev().length||Gallery.prev.addClass("disabled")),Gallery.moveto=Gallery.calcMoveTo(),Gallery.last.removeClass("selected"),Gallery.current.addClass("selected"),Gallery.figures.transition({x:Math.floor(Gallery.moveto)},Gallery.speed,function(){Gallery.moving=!1})),Gallery.moveThumb(Gallery.thumb.find("li").eq(Gallery.current.index()))},moveThumb:function(e){Gallery.thumb.find(".selected").removeClass("selected"),e.addClass("selected");var l=20,a=e.width(),r=e.position().left,t=r+a;if(Gallery.monitor_w<t+l||0>r){var i=parseFloat(Gallery.thumb.css("x"))+(Gallery.monitor_c-(r+a/2)),n=Gallery.monitor_w-Gallery.thumb.width();Gallery.thumb.transition({x:i>0?0:n>i?n:i},Gallery.speed)}},thumbEvent:function(e){if(!Gallery.moving&&!Gallery.dragmoved){Gallery.moving=!0;var l=$(e.target),a=l.closest("li"),r=a.index();Gallery.last=Gallery.current,Gallery.current=Gallery.figures.find("figure").eq(r),Gallery.last.removeClass("selected"),Gallery.current.addClass("selected"),Gallery.moveThumb(a);var t=Gallery.speed+100*(Math.abs(Gallery.last.index()-Gallery.current.index())-1);Gallery.moveto=Gallery.calcMoveTo(),Gallery.figures.transition({x:Gallery.moveto},t,function(){Gallery.moving=!1,Gallery.dragmoved=!1}),r>0?Gallery.prev.removeClass("disabled"):(Gallery.prev.addClass("disabled"),Gallery.next.removeClass("disabled")),Gallery.current.next().length||Gallery.next.addClass("disabled"),console.log(Gallery.current.next().length)}},calcMoveTo:function(){return parseFloat(Gallery.figures.css("x"))+(Gallery.monitor_c-(Gallery.current.position().left+Gallery.current.width()/2))}};